<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.neefull.fsp.web.qff.mapper.RecentMapper">
    <update id="updateRecentStatus" >
        update qff_recent set status = #{status} where id = #{id}
    </update>


    <select id="getRecentPage" resultType="com.neefull.fsp.web.qff.entity.Recent">
        select * from qff_recent where 1=1
        <if test="recent.kMater!=null and recent.kMater!=''">
            and k_mater like concat('%',#{recent.kMater},'%')
        </if>
        <if test="recent.batch!=null and recent.batch!=''">
            and batch like concat('%',#{recent.batch},'%')
        </if>
        <if test="recent.transport!=null and recent.transport!=''">
            and transport like concat('%',#{recent.transport},'%')
        </if>
        <if test="recent.rMater!=null and recent.rMater!=''">
            and r_mater like concat('%',#{recent.rMater},'%')
        </if>
        <if test="recent.name!=null and recent.name!=''">
            and name like concat('%',#{recent.name},'%')
        </if>
        <if test="recent.useLife!=null and recent.useLife!=''">
            and use_life like concat('%',#{recent.useLife},'%')
        </if>
        <if test="recent.sapBatch!=null and recent.sapBatch!=''">
            and sap_batch like concat('%',#{recent.sapBatch},'%')
        </if>
        <if test="recent.factory!=null and recent.factory!=''">
            and factory like concat('%',#{recent.factory},'%')
        </if>
        <if test="recent.wareHouse!=null and recent.wareHouse!=''">
            and ware_house like concat('%',#{recent.wareHouse},'%')
        </if>
        <if test="recent.number!=null and recent.number!=''">
            and number like concat('%',#{recent.number},'%')
        </if>
        <if test="recent.rConf!=null and recent.rConf!=''">
            and r_conf like concat('%',#{recent.rConf},'%')
        </if>
        <if test="recent.repDate!=null and recent.repDate!=''">
            and rep_date like concat('%',#{recent.repDate},'%')
        </if>
        <if test="recent.startTime!=null and recent.startTime!='' and recent.endTime!=null and recent.endTime!=''">
            and date_format(create_time,'%Y-%m-%d')  between  #{recent.startTime} and  #{recent.endTime}
        </if>
        <choose>
            <when test="recent.status!=null and recent.status!=''">
                and status = #{recent.status}
            </when>
            <otherwise>
                and status != 4
            </otherwise>
        </choose>
    order by create_time desc
    </select>
    <select id="getPageConserve" resultType="com.neefull.fsp.web.qff.entity.Recent">
        select * from qff_recent where 1=1
        <if test="kMater!=null and kMater!=''">
            and k_mater like concat('%',#{kMater},'%')
        </if>
        <if test="batch!=null and batch!=''">
            and batch like concat('%',#{batch},'%')
        </if>
        <if test="transport!=null and transport!=''">
            and transport like concat('%',#{transport},'%')
        </if>
        <if test="rMater!=null and rMater!=''">
            and r_mater like concat('%',#{rMater},'%')
        </if>
        <if test="name!=null and name!=''">
            and name like concat('%',#{name},'%')
        </if>
        <if test="useLife!=null and useLife!=''">
            and use_life like concat('%',#{useLife},'%')
        </if>
        <if test="sapBatch!=null and sapBatch!=''">
            and sap_batch like concat('%',#{sapBatch},'%')
        </if>
        <if test="factory!=null and factory!=''">
            and factory like concat('%',#{factory},'%')
        </if>
        <if test="wareHouse!=null and wareHouse!=''">
            and ware_house like concat('%',#{wareHouse},'%')
        </if>
        <if test="number!=null and number!=''">
            and number like concat('%',#{number},'%')
        </if>
        <if test="rConf!=null and rConf!=''">
            and r_conf like concat('%',#{rConf},'%')
        </if>
        <if test="repDate!=null and repDate!=''">
            and rep_date like concat('%',#{repDate},'%')
        </if>
        <if test="startTime!=null and startTime!='' and endTime!=null and endTime!=''">
            and date_format(create_time,'%Y-%m-%d')  between  #{startTime} and  #{endTime}
        </if>
        <choose>
            <when test="status == '2'">
                and status = 2
            </when>
            <otherwise>
                and status != 4
            </otherwise>
        </choose>
        order by create_time desc
        <if test="pageNum == null " >
            limit  #{pageSize}
        </if>
    </select>
</mapper>